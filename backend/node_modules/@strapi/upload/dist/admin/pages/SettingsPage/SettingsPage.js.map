{"version":3,"file":"SettingsPage.js","sources":["../../../../admin/src/pages/SettingsPage/SettingsPage.tsx"],"sourcesContent":["// TODO: find a better naming convention for the file that was an index file before\nimport * as React from 'react';\n\nimport {\n  Page,\n  useNotification,\n  useFetchClient,\n  Layouts,\n  ConfirmDialog,\n} from '@strapi/admin/strapi-admin';\nimport { useAIAvailability } from '@strapi/admin/strapi-admin/ee';\nimport {\n  Box,\n  Button,\n  Dialog,\n  Flex,\n  Grid,\n  Toggle,\n  Typography,\n  Field,\n  Status,\n  Divider,\n  StatusProps,\n  TextButton,\n} from '@strapi/design-system';\nimport { Check, Sparkle } from '@strapi/icons';\nimport isEqual from 'lodash/isEqual';\nimport { useIntl } from 'react-intl';\nimport { useMutation, useQuery } from 'react-query';\n\nimport { AIMetadataJob } from '../../../../shared/contracts/ai-metadata-jobs';\nimport { GetAIMetadataCount, GenerateAIMetadata } from '../../../../shared/contracts/files';\nimport { UpdateSettings } from '../../../../shared/contracts/settings';\nimport { PERMISSIONS } from '../../constants';\nimport { useAIMetadataJob } from '../../hooks/useAIMetadataJob';\nimport { useSettings } from '../../hooks/useSettings';\nimport { useTracking } from '../../hooks/useTracking';\nimport { getTrad } from '../../utils';\n\nimport { init } from './init';\nimport { initialState, reducer } from './reducer';\n\nimport type { InitialState } from './reducer';\n\n/* -------------------------------------------------------------------------------------------------\n * MetadataAction\n * -----------------------------------------------------------------------------------------------*/\n\nconst BetaStatus = (props: Omit<StatusProps, 'children'>) => {\n  const { formatMessage } = useIntl();\n\n  return (\n    <Status\n      size=\"S\"\n      variant=\"secondary\"\n      style={{ textTransform: 'uppercase', display: 'flex' }}\n      {...props}\n    >\n      <Typography tag=\"span\" variant=\"pi\" fontWeight=\"bold\">\n        {formatMessage({\n          id: 'app.components.Status.beta',\n          defaultMessage: 'Beta',\n        })}\n      </Typography>\n    </Status>\n  );\n};\n\ninterface MetadataActionProps {\n  job: AIMetadataJob | null;\n  imagesWithoutMetadataCount: number;\n  isConfirmDialogOpen: boolean;\n  onConfirmDialogChange: (open: boolean) => void;\n  onGenerate: () => Promise<void>;\n}\n\nconst MetadataAction = ({\n  job,\n  imagesWithoutMetadataCount,\n  isConfirmDialogOpen,\n  onConfirmDialogChange,\n  onGenerate,\n}: MetadataActionProps) => {\n  const { formatMessage } = useIntl();\n\n  // If there's an active job processing\n  if (job?.status === 'processing') {\n    return (\n      <Flex gap={2} alignItems=\"center\">\n        <Typography variant=\"pi\" textColor=\"neutral600\">\n          {formatMessage({\n            id: getTrad('settings.form.aiMetadata.generatingMetadata'),\n            defaultMessage: 'AI is generating your metadata',\n          })}\n        </Typography>\n      </Flex>\n    );\n  }\n\n  // Only show completed state when all images have metadata\n  if (imagesWithoutMetadataCount === 0) {\n    return (\n      <Typography variant=\"pi\" textColor=\"primary600\">\n        <Flex gap={2} alignItems=\"center\">\n          <Check width=\"16px\" height=\"16px\" />\n          {formatMessage({\n            id: getTrad('settings.form.aiMetadata.metadataGenerated'),\n            defaultMessage: 'Your metadata has been generated',\n          })}\n        </Flex>\n      </Typography>\n    );\n  }\n\n  return (\n    <Dialog.Root open={isConfirmDialogOpen} onOpenChange={onConfirmDialogChange}>\n      <Dialog.Trigger>\n        <TextButton disabled={imagesWithoutMetadataCount === 0}>\n          {formatMessage({\n            id: getTrad('settings.form.aiMetadata.generateButton'),\n            defaultMessage: 'Generate metadata',\n          })}\n        </TextButton>\n      </Dialog.Trigger>\n      <ConfirmDialog\n        variant=\"success-light\"\n        onConfirm={onGenerate}\n        title={\n          <Flex gap={2}>\n            <BetaStatus />\n            {formatMessage({\n              id: getTrad('settings.form.aiMetadata.confirmDialog.title'),\n              defaultMessage: 'Generate AI Metadata',\n            })}\n          </Flex>\n        }\n      >\n        {formatMessage(\n          {\n            id: getTrad('settings.form.aiMetadata.confirmDialog.message'),\n            defaultMessage:\n              'This will start a process in the background to generate captions and alternative text for {count, plural, one {# image} other {# images}}. AI can make mistakes, be sure to review the generated content.',\n          },\n          { count: imagesWithoutMetadataCount }\n        )}\n      </ConfirmDialog>\n    </Dialog.Root>\n  );\n};\n\n/* -------------------------------------------------------------------------------------------------\n * SettingsPage\n * -----------------------------------------------------------------------------------------------*/\n\nexport const SettingsPage = () => {\n  const { formatMessage } = useIntl();\n  const { toggleNotification } = useNotification();\n  const { put, post, get } = useFetchClient();\n  const [isConfirmDialogOpen, setIsConfirmDialogOpen] = React.useState(false);\n  const { trackUsage } = useTracking();\n\n  const [{ initialData, modifiedData }, dispatch] = React.useReducer(reducer, initialState, init);\n\n  const { data, isLoading, refetch } = useSettings();\n  const isAIAvailable = useAIAvailability();\n\n  const { data: imageCountResponse, isLoading: isLoadingImagesWithoutMetadataCount } = useQuery<\n    GetAIMetadataCount.Response['data'],\n    GetAIMetadataCount.Response['error']\n  >(\n    ['ai-metadata-count'],\n    async () => {\n      const { data } = await get('/upload/actions/generate-ai-metadata/count');\n      return data;\n    },\n    {\n      enabled: isAIAvailable && !!data?.aiMetadata,\n      retry: false,\n    }\n  );\n\n  const imagesWithoutMetadataCount = imageCountResponse?.imagesWithoutMetadataCount ?? 0;\n\n  React.useEffect(() => {\n    if (data) {\n      dispatch({\n        type: 'GET_DATA_SUCCEEDED',\n        data,\n      });\n    }\n  }, [data]);\n\n  const isSaveButtonDisabled = isEqual(initialData, modifiedData);\n\n  const { mutateAsync, isLoading: isSubmitting } = useMutation<\n    UpdateSettings.Response['data'],\n    UpdateSettings.Response['error'],\n    UpdateSettings.Request['body']\n  >(\n    async (body) => {\n      const { data } = await put('/upload/settings', body);\n\n      return data;\n    },\n    {\n      onSuccess() {\n        refetch();\n\n        toggleNotification({\n          type: 'success',\n          message: formatMessage({ id: 'notification.form.success.fields' }),\n        });\n      },\n      onError(err: any) {\n        toggleNotification({\n          type: 'danger',\n          message: err.message || formatMessage({ id: 'notification.error' }),\n        });\n      },\n    }\n  );\n\n  // Poll for latest active job - notifications are handled inside the hook\n  const { data: aiMetadataJob, refetch: refetchAiMetadataJob } = useAIMetadataJob({\n    enabled: isAIAvailable,\n  });\n\n  const { mutateAsync: startGenerateAIMetadata } = useMutation<\n    GenerateAIMetadata.Response['data'],\n    GenerateAIMetadata.Response['error'],\n    void\n  >(\n    async () => {\n      const { data } = await post('/upload/actions/generate-ai-metadata', {});\n      return data;\n    },\n    {\n      onSuccess() {\n        setIsConfirmDialogOpen(false);\n        // Refetch job status to start polling the new job\n        refetchAiMetadataJob();\n      },\n      onError(err) {\n        toggleNotification({\n          type: 'danger',\n          message: (err as Error)?.message || formatMessage({ id: 'notification.error' }),\n        });\n        setIsConfirmDialogOpen(false);\n      },\n    }\n  );\n\n  const handleSubmit = async (e: React.FormEvent<HTMLFormElement>) => {\n    e.preventDefault();\n\n    if (isSaveButtonDisabled) {\n      return;\n    }\n\n    await mutateAsync(modifiedData!);\n  };\n\n  const handleChange = ({\n    target: { name, value },\n  }: {\n    target: { name: keyof NonNullable<InitialState['initialData']>; value: boolean };\n  }) => {\n    dispatch({\n      type: 'ON_CHANGE',\n      keys: name,\n      value,\n    });\n  };\n\n  if (isLoading) {\n    return <Page.Loading />;\n  }\n\n  return (\n    <Page.Main tabIndex={-1}>\n      <Page.Title>\n        {formatMessage({\n          id: getTrad('page.title'),\n          defaultMessage: 'Settings - Media Library',\n        })}\n      </Page.Title>\n      <form onSubmit={handleSubmit}>\n        <Layouts.Header\n          title={formatMessage({\n            id: getTrad('settings.header.label'),\n            defaultMessage: 'Media Library',\n          })}\n          primaryAction={\n            <Button\n              disabled={isSaveButtonDisabled}\n              loading={isSubmitting}\n              type=\"submit\"\n              startIcon={<Check />}\n              size=\"S\"\n              fullWidth\n            >\n              {formatMessage({\n                id: 'global.save',\n                defaultMessage: 'Save',\n              })}\n            </Button>\n          }\n          subtitle={formatMessage({\n            id: getTrad('settings.sub-header.label'),\n            defaultMessage: 'Configure the settings for the Media Library',\n          })}\n        />\n        <Layouts.Content>\n          <Layouts.Root>\n            <Flex direction=\"column\" alignItems=\"stretch\" gap={4}>\n              {/* AI features section when ai is available */}\n              {isAIAvailable && (\n                <Box background=\"neutral0\" padding={6} shadow=\"filterShadow\" hasRadius>\n                  <Flex direction=\"column\" alignItems=\"stretch\" gap={1}>\n                    <Grid.Root gap={6}>\n                      <Grid.Item col={8} xs={12} direction=\"column\" alignItems=\"stretch\">\n                        <Flex gap={2}>\n                          <Box color=\"alternative700\">\n                            <Sparkle />\n                          </Box>\n                          <Typography variant=\"delta\" tag=\"h2\">\n                            {formatMessage({\n                              id: getTrad('settings.form.aiMetadata.label'),\n                              defaultMessage:\n                                'Generate AI captions and alt texts automatically on upload!',\n                            })}\n                          </Typography>\n                        </Flex>\n                        <Flex paddingTop={1}>\n                          <Typography variant=\"pi\" textColor=\"neutral600\">\n                            {formatMessage({\n                              id: getTrad('settings.form.aiMetadata.description'),\n                              defaultMessage:\n                                'Enable this feature to save time, optimize your SEO and increase accessibility by letting our AI generate captions and alternative texts for you.',\n                            })}\n                          </Typography>\n                        </Flex>\n                      </Grid.Item>\n                      <Grid.Item\n                        col={4}\n                        xs={12}\n                        direction=\"column\"\n                        alignItems=\"end\"\n                        justifyContent={'center'}\n                      >\n                        <Field.Root name=\"aiMetadata\" minWidth=\"200px\">\n                          <Toggle\n                            checked={modifiedData?.aiMetadata}\n                            offLabel={formatMessage({\n                              id: 'app.components.ToggleCheckbox.disabled-label',\n                              defaultMessage: 'Disabled',\n                            })}\n                            onLabel={formatMessage({\n                              id: 'app.components.ToggleCheckbox.enabled-label',\n                              defaultMessage: 'Enabled',\n                            })}\n                            onChange={(e) => {\n                              handleChange({\n                                target: { name: 'aiMetadata', value: e.target.checked },\n                              });\n                            }}\n                          />\n                        </Field.Root>\n                      </Grid.Item>\n                    </Grid.Root>\n                    {/* Retroactive metadata generation when aiMetadata is enabled */}\n                    {initialData?.aiMetadata &&\n                      !isLoadingImagesWithoutMetadataCount &&\n                      Boolean(imageCountResponse?.totalImages) && (\n                        <>\n                          <Divider marginTop={4} marginBottom={4} />\n                          <Flex justifyContent=\"space-between\" alignItems=\"center\" gap={2}>\n                            <Flex gap={2}>\n                              <BetaStatus size=\"XS\" />\n                              <Typography variant=\"pi\" textColor=\"neutral500\">\n                                {imagesWithoutMetadataCount === 0\n                                  ? formatMessage({\n                                      id: getTrad('settings.form.aiMetadata.allAssetsHaveMetadata'),\n                                      defaultMessage: 'All assets have caption and alt text',\n                                    })\n                                  : formatMessage(\n                                      {\n                                        id: getTrad(\n                                          'settings.form.aiMetadata.imagesWithoutMetadata'\n                                        ),\n                                        defaultMessage:\n                                          '{count, plural, one {# image lacks captions or alternative text} other {# images lack captions or alternative text}}',\n                                      },\n                                      { count: imagesWithoutMetadataCount }\n                                    )}\n                              </Typography>\n                            </Flex>\n                            <MetadataAction\n                              job={aiMetadataJob ?? null}\n                              imagesWithoutMetadataCount={imagesWithoutMetadataCount}\n                              isConfirmDialogOpen={isConfirmDialogOpen}\n                              onConfirmDialogChange={setIsConfirmDialogOpen}\n                              onGenerate={async () => {\n                                await startGenerateAIMetadata();\n                                trackUsage('didGenerateMetadataRetroactively');\n                              }}\n                            />\n                          </Flex>\n                        </>\n                      )}\n                  </Flex>\n                </Box>\n              )}\n\n              <Box background=\"neutral0\" padding={6} shadow=\"filterShadow\" hasRadius>\n                <Flex direction=\"column\" alignItems=\"stretch\" gap={4}>\n                  <Flex>\n                    <Typography variant=\"delta\" tag=\"h2\">\n                      {formatMessage({\n                        id: getTrad('settings.blockTitle'),\n                        defaultMessage: 'Asset management',\n                      })}\n                    </Typography>\n                  </Flex>\n                  <Grid.Root gap={6}>\n                    <Grid.Item col={6} xs={12} direction=\"column\" alignItems=\"stretch\">\n                      <Field.Root\n                        hint={formatMessage({\n                          id: getTrad('settings.form.responsiveDimensions.description'),\n                          defaultMessage:\n                            'Enabling this option will generate multiple formats (small, medium and large) of the uploaded asset.',\n                        })}\n                        name=\"responsiveDimensions\"\n                      >\n                        <Field.Label>\n                          {formatMessage({\n                            id: getTrad('settings.form.responsiveDimensions.label'),\n                            defaultMessage: 'Responsive friendly upload',\n                          })}\n                        </Field.Label>\n                        <Toggle\n                          checked={modifiedData?.responsiveDimensions}\n                          offLabel={formatMessage({\n                            id: 'app.components.ToggleCheckbox.off-label',\n                            defaultMessage: 'Off',\n                          })}\n                          onLabel={formatMessage({\n                            id: 'app.components.ToggleCheckbox.on-label',\n                            defaultMessage: 'On',\n                          })}\n                          onChange={(e) => {\n                            handleChange({\n                              target: { name: 'responsiveDimensions', value: e.target.checked },\n                            });\n                          }}\n                        />\n                        <Field.Hint />\n                      </Field.Root>\n                    </Grid.Item>\n                    <Grid.Item col={6} xs={12} direction=\"column\" alignItems=\"stretch\">\n                      <Field.Root\n                        hint={formatMessage({\n                          id: getTrad('settings.form.sizeOptimization.description'),\n                          defaultMessage:\n                            'Enabling this option will reduce the image size and slightly reduce its quality.',\n                        })}\n                        name=\"sizeOptimization\"\n                      >\n                        <Field.Label>\n                          {formatMessage({\n                            id: getTrad('settings.form.sizeOptimization.label'),\n                            defaultMessage: 'Size optimization',\n                          })}\n                        </Field.Label>\n                        <Toggle\n                          checked={modifiedData?.sizeOptimization}\n                          offLabel={formatMessage({\n                            id: 'app.components.ToggleCheckbox.off-label',\n                            defaultMessage: 'Off',\n                          })}\n                          onLabel={formatMessage({\n                            id: 'app.components.ToggleCheckbox.on-label',\n                            defaultMessage: 'On',\n                          })}\n                          onChange={(e) => {\n                            handleChange({\n                              target: { name: 'sizeOptimization', value: e.target.checked },\n                            });\n                          }}\n                        />\n                        <Field.Hint />\n                      </Field.Root>\n                    </Grid.Item>\n                    <Grid.Item col={6} xs={12} direction=\"column\" alignItems=\"stretch\">\n                      <Field.Root\n                        hint={formatMessage({\n                          id: getTrad('settings.form.autoOrientation.description'),\n                          defaultMessage:\n                            'Enabling this option will automatically rotate the image according to EXIF orientation tag.',\n                        })}\n                        name=\"autoOrientation\"\n                      >\n                        <Field.Label>\n                          {formatMessage({\n                            id: getTrad('settings.form.autoOrientation.label'),\n                            defaultMessage: 'Auto orientation',\n                          })}\n                        </Field.Label>\n                        <Toggle\n                          checked={modifiedData?.autoOrientation}\n                          offLabel={formatMessage({\n                            id: 'app.components.ToggleCheckbox.off-label',\n                            defaultMessage: 'Off',\n                          })}\n                          onLabel={formatMessage({\n                            id: 'app.components.ToggleCheckbox.on-label',\n                            defaultMessage: 'On',\n                          })}\n                          onChange={(e) => {\n                            handleChange({\n                              target: { name: 'autoOrientation', value: e.target.checked },\n                            });\n                          }}\n                        />\n                        <Field.Hint />\n                      </Field.Root>\n                    </Grid.Item>\n                  </Grid.Root>\n                </Flex>\n              </Box>\n            </Flex>\n          </Layouts.Root>\n        </Layouts.Content>\n      </form>\n    </Page.Main>\n  );\n};\n\nexport const ProtectedSettingsPage = () => (\n  <Page.Protect permissions={PERMISSIONS.settings}>\n    <SettingsPage />\n  </Page.Protect>\n);\n"],"names":["BetaStatus","props","formatMessage","useIntl","_jsx","Status","size","variant","style","textTransform","display","Typography","tag","fontWeight","id","defaultMessage","MetadataAction","job","imagesWithoutMetadataCount","isConfirmDialogOpen","onConfirmDialogChange","onGenerate","status","Flex","gap","alignItems","textColor","getTrad","_jsxs","Check","width","height","Dialog","Root","open","onOpenChange","Trigger","TextButton","disabled","ConfirmDialog","onConfirm","title","count","SettingsPage","toggleNotification","useNotification","put","post","get","useFetchClient","setIsConfirmDialogOpen","React","useState","trackUsage","useTracking","initialData","modifiedData","dispatch","useReducer","reducer","initialState","init","data","isLoading","refetch","useSettings","isAIAvailable","useAIAvailability","imageCountResponse","isLoadingImagesWithoutMetadataCount","useQuery","enabled","aiMetadata","retry","useEffect","type","isSaveButtonDisabled","isEqual","mutateAsync","isSubmitting","useMutation","body","onSuccess","message","onError","err","aiMetadataJob","refetchAiMetadataJob","useAIMetadataJob","startGenerateAIMetadata","handleSubmit","e","preventDefault","handleChange","target","name","value","keys","Page","Loading","Main","tabIndex","Title","form","onSubmit","Layouts","Header","primaryAction","Button","loading","startIcon","fullWidth","subtitle","Content","direction","Box","background","padding","shadow","hasRadius","Grid","Item","col","xs","color","Sparkle","paddingTop","justifyContent","Field","minWidth","Toggle","checked","offLabel","onLabel","onChange","Boolean","totalImages","_Fragment","Divider","marginTop","marginBottom","hint","Label","responsiveDimensions","Hint","sizeOptimization","autoOrientation","ProtectedSettingsPage","Protect","permissions","PERMISSIONS","settings"],"mappings":"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"}