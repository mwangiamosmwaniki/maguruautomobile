{"version":3,"file":"model-cache.js","sources":["../src/model-cache.ts"],"sourcesContent":["import type { Model } from './types';\n\n/**\n * Model cache to prevent redundant getModel() calls during populate traversal.\n *\n * Models don't change at runtime (changes require server restart), so caching\n * is safe. Current scoping (per-request) provides isolation and predictable\n * memory behavior.\n */\n\n/**\n * Creates cache for getModel() calls.\n *\n * @param getModelFn - The underlying getModel function to cache\n * @returns An object with cached getModel function and clear method\n */\nexport const createModelCache = (\n  getModelFn: (\n    uid: // TODO should use the type from @strapi/types but this package doesn't depend on it\n    any\n  ) => Model\n) => {\n  const cache = new Map<string, Model>();\n\n  return {\n    getModel(uid: any): Model {\n      const cached = cache.get(uid);\n      if (cached) {\n        return cached;\n      }\n\n      const model = getModelFn(uid);\n      cache.set(uid, model);\n      return model;\n    },\n    clear() {\n      cache.clear();\n    },\n  };\n};\n"],"names":["createModelCache","getModelFn","cache","Map","getModel","uid","cached","get","model","set","clear"],"mappings":";;AAEA;;;;;;;;;;;IAcaA,MAAAA,gBAAAA,GAAmB,CAC9BC,UAAAA,GAAAA;AAKA,IAAA,MAAMC,QAAQ,IAAIC,GAAAA,EAAAA;IAElB,OAAO;AACLC,QAAAA,QAAAA,CAAAA,CAASC,GAAQ,EAAA;YACf,MAAMC,MAAAA,GAASJ,KAAMK,CAAAA,GAAG,CAACF,GAAAA,CAAAA;AACzB,YAAA,IAAIC,MAAQ,EAAA;gBACV,OAAOA,MAAAA;AACT;AAEA,YAAA,MAAME,QAAQP,UAAWI,CAAAA,GAAAA,CAAAA;YACzBH,KAAMO,CAAAA,GAAG,CAACJ,GAAKG,EAAAA,KAAAA,CAAAA;YACf,OAAOA,KAAAA;AACT,SAAA;AACAE,QAAAA,KAAAA,CAAAA,GAAAA;AACER,YAAAA,KAAAA,CAAMQ,KAAK,EAAA;AACb;AACF,KAAA;AACF;;;;"}